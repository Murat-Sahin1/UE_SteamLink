# MultiplayerSessions v0.4.0 Release Notes

**Release Date:** January 14, 2026

## Overview

Version 0.4.0 introduces a complete **Ready-Up System** and **Lobby HUD UI** for in-lobby player management. This release enables players to indicate readiness before the host starts the game, with full network replication support.

## Highlights

### Ready-Up System

Players can now toggle their ready state in the lobby. The host can only start the game when all connected players are ready.

- **Server-authoritative** - All ready state changes validated on server
- **Fully replicated** - Ready states sync across all clients automatically
- **Delegate-driven** - UI and gameplay can react to ready state changes

### Lobby HUD

A new in-lobby UI system displays connected players and their ready status:

- See all players in the lobby with their ready/not ready status
- Toggle your own ready state with a single button
- Host sees a "Start Game" button (enabled only when all players ready)
- Leave lobby at any time

## New Components

### C++ Classes

| Class | Description |
|-------|-------------|
| `ALobbyPlayerState` | PlayerState with replicated `bIsReady` property |
| `ALobbyGameState` | GameState with ready player queries and delegates |
| `ALobbyGameMode` | GameMode with `StartGame()` and ready-state delegates |
| `ULobbyHUDWidget` | Main lobby screen HUD widget |
| `ULobbyPlayerEntryWidget` | Individual player row in lobby list |

### Blueprint Widgets

| Widget | Description |
|--------|-------------|
| `WBP_LobbyHUD` | Lobby screen with player list, ready button, start/leave buttons |
| `WBP_LobbyPlayerEntry` | Player entry showing name, ready status, host indicator |

## API Reference

### ALobbyPlayerState

```cpp
// Toggle ready state (calls server RPC internally)
void SetReadyState(bool bNewReadyState);
void ToggleReadyState();

// Query
bool IsReady() const;

// Delegate - fires when this player's ready state changes
FOnPlayerReadyStateChangedSignature OnReadyStateChanged;
```

### ALobbyGameState

```cpp
// Queries
bool AreAllPlayersReady() const;
int32 GetReadyPlayerCount() const;
int32 GetTotalPlayerCount() const;
TArray<ALobbyPlayerState*> GetLobbyPlayerStates() const;

// Delegate - fires when any player's ready state changes
FOnPlayerReadyStateChangedDelegate OnPlayerReadyStateChanged;
```

### ALobbyGameMode

```cpp
// Start the game (server only, requires all players ready)
bool StartGame(const FString& GameLevelPath);
bool CanStartGame() const;

// Delegates
FOnAllPlayersReady OnAllPlayersReady;
FOnNotAllPlayersReady OnNotAllPlayersReady;
FOnGameStarted OnGameStarted;
```

### ULobbyHUDWidget

```cpp
// Setup and teardown
void InitializeLobbyHUD();
void MenuSetup();
void MenuTearDown();

// Refresh display
void RefreshPlayerList();

// Query
bool IsLocalPlayerHost() const;
```

## Usage Example

### Blueprint Setup

1. Create a Lobby Level with `BP_LobbyGameMode` as the GameMode Override
2. In your Level Blueprint or PlayerController:
   ```
   Create Widget (WBP_LobbyHUD) → Add to Viewport → Call MenuSetup
   ```
3. Set the `PlayerEntryWidgetClass` property to `WBP_LobbyPlayerEntry`
4. Set the `GameLevelPath` property to your game level (e.g., `/Game/Maps/Lvl_Game?listen`)

### C++ Setup

```cpp
// In your lobby level's BeginPlay or PlayerController
ULobbyHUDWidget* LobbyHUD = CreateWidget<ULobbyHUDWidget>(PlayerController, LobbyHUDClass);
if (LobbyHUD)
{
    LobbyHUD->MenuSetup();
}
```

## Technical Details

- **Replication**: Uses `DOREPLIFETIME` macros and `ReplicatedUsing` callbacks
- **Network Pattern**: Client → Server RPC → Replicated Property → OnRep Callback
- **Delegate Chain**: PlayerState → GameState → GameMode → UI Widgets
- **Dependencies**: Added `NetCore` module for replication support

## Migration Notes

- Lobby framework classes (`LobbyGameMode`, `LobbyGameState`, `LobbyPlayerState`) moved from game source into the plugin
- If you were using these classes from `Source/MenuSystem/`, update your includes to use the plugin path

## Known Limitations

- `OnGameStarted` delegate only fires on the server (GameMode is server-only)
- Clients are automatically transitioned via `ServerTravel` - no client-side callback needed

## What's Next

- **Proper Menu UI Design** - Pleasing menu design
- **Lobby Level Design** - Visual lobby environment (TBD: dashboard UI vs 3D space)
